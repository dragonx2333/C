联合（共用体）

### 一、联合的定义

```c
union 联合名 
{
    数据类型1 成员名1;
    数据类型2 成员名2;
    ...
};
```

### 二、联合的特性

1. **内存共用**：联合的所有成员都占用同一个内存位置。在某一时刻，联合只能存储它的某一个成员的值，即联合在任何时候都只能有一个成员是有效的。
2. **内存大小**：联合的大小是其最大成员的大小，而不是所有成员大小的总和。这是因为所有成员都共享同一块内存。
3. **成员访问**：访问联合的一个成员后，再访问另一个成员会导致前一个成员的值被覆盖。因此，使用联合时需要特别小心，以避免数据丢失或覆盖。

### 三、联合大小的计算

1. **确定最大成员**：首先，找出联合中所有成员中大小最大的那个成员。

2. **计算对齐数**：然后，确定这个最大成员的对齐数。

3. **调整联合大小**：如果最大成员的大小不是其对齐数的整数倍，那么联合的大小需要调整到这个对齐数的下一个整数倍。

4. **事例**：

   ~~~c
   union Un
   {
       int a;//对齐数：4
       char arr[5];//对齐数：1
   }//最大成员大小：5（arr），跳到下一个最大对齐数：8
   ~~~

   

### 三、联合的使用场景

1. **节省内存**：联合的主要目的是节省内存。通过在同一内存位置存储不同类型的数据，可以根据需要选择访问其中的任何一个成员，从而避免了为每个成员分配独立的内存空间。
2. **数据类型转换**：联合可以用于实现数据类型之间的转换。例如，可以将一个浮点数的二进制表示转换为整数表示，或者将一个整数的二进制表示转换为其他类型的数据。
3. **处理不同类型的消息**：在网络编程中，联合可以用于处理不同类型的消息。例如，一个网络协议可能包含多种消息类型，可以使用联合来定义消息结构，并根据消息类型来访问相应的成员。